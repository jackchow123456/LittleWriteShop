!function(e){var a={};function t(i){if(a[i])return a[i].exports;var r=a[i]={i:i,l:!1,exports:{}};return e[i].call(r.exports,r,r.exports,t),r.l=!0,r.exports}t.m=e,t.c=a,t.d=function(e,a,i){t.o(e,a)||Object.defineProperty(e,a,{enumerable:!0,get:i})},t.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},t.t=function(e,a){if(1&a&&(e=t(e)),8&a)return e;if(4&a&&"object"==typeof e&&e&&e.__esModule)return e;var i=Object.create(null);if(t.r(i),Object.defineProperty(i,"default",{enumerable:!0,value:e}),2&a&&"string"!=typeof e)for(var r in e)t.d(i,r,function(a){return e[a]}.bind(null,r));return i},t.n=function(e){var a=e&&e.__esModule?function(){return e.default}:function(){return e};return t.d(a,"a",a),a},t.o=function(e,a){return Object.prototype.hasOwnProperty.call(e,a)},t.p="/",t(t.s=11)}({11:function(e,a,t){e.exports=t(12)},12:function(e,a){!function(e,a){function t(t){t=a.extend({wrapper:".web-uploader",addFileButton:".add-file-button",isImage:!1,preview:[],server:"",updateServer:"",sortable:!1,deleteUrl:"",deleteData:{},thumbHeight:160,disabled:!1,autoUpdateColumn:!1,disableRemove:!1,dimensions:{},lang:{exceed_size:"文件大小超出",interrupt:"上传暂停",upload_failed:"上传失败，请重试",selected_files:"选中:num个文件，共:size。",selected_has_failed:'已成功上传:success个文件，:fail个文件上传失败，<a class="retry"  href="javascript:"";">重新上传</a>失败文件或<a class="ignore" href="javascript:"";">忽略</a>',selected_success:"共:num个(:size)，已上传:success个。",dot:"，",failed_num:"失败:fail个。",pause_upload:"暂停上传",go_on_upload:"继续上传",start_upload:"开始上传",upload_success_message:"已成功上传:success个文件",go_on_add:"继续添加",Q_TYPE_DENIED:"对不起，不允许上传此类型文件",Q_EXCEED_NUM_LIMIT:"对不起，已超出文件上传数量限制，最多只能上传:num个文件",F_EXCEED_SIZE:"对不起，当前选择的文件过大",Q_EXCEED_SIZE_LIMIT:"对不起，已超出文件大小限制",F_DUPLICATE:"文件重复",confirm_delete_file:"您确定要删除这个文件吗？"},upload:{formData:{_id:null},thumb:{width:160,height:160,quality:70,allowMagnify:!0,crop:!0,preserveHeaders:!1,type:"image/jpeg"}}},t);var i=a(t.selector),r=t.upload.formData.upload_column||"webup"+Math.floor(1e4*Math.random()),n=t.elementName;void 0!==t.upload.formData._id&&t.upload.formData._id||(t.upload.formData._id=r+Math.floor(1e4*Math.random()));var s,l,o,d,c,u,f,p,m,h,v,b=e.Dcat,g=t.isImage,w=b.helpers.len(t.preview),_=i.find('input[name="'+n+'"]'),y=function(e){return n.replace(/[\[\]]*/g,"_")+"-"+e},I=function(e){return a("#"+y(e))},k=t.addFileButton,x={},E={},F=0,C=0,N="pedding",D={},U=(h=new Image,v=!0,h.onload=h.onerror=function(){1==this.width&&1==this.height||(v=!1)},h.src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///ywAAAAAAQABAAACAUwAOw==",v),A=function(){var e;try{e=(e=navigator.plugins["Shockwave Flash"]).description}catch(a){try{e=new ActiveXObject("ShockwaveFlash.ShockwaveFlash").GetVariable("$version")}catch(a){e="0.0"}}return e=e.match(/\d+/g),parseFloat(e[0]+"."+e[1],10)}(),S=function(e){return e.type.match(/^image/)},T=b.Translator(t.lang),L=T.trans.bind(T),z=[];function M(e){var i,n,s=WebUploader.formatSize(e.size),o=e.name||null;g?(i=a('<li id="'.concat(y(e.id),'" title="').concat(o,'" >\n                    <p class="file-type">').concat(e.ext.toUpperCase()||"FILE",'</p>\n                    <p class="imgWrap "></p>\n                    <p class="title" style="">').concat(e.name,'</p>\n                    <p class="title" style="margin-bottom:20px;">(<b>').concat(s,"</b>)</p>\n                    </li>")),n=a('<div class="file-panel">\n                    <a class="btn btn-sm btn-white" data-file-act="cancel"><i class="feather icon-x red-dark" style="font-size:13px"></i></a>\n                    <a class="btn btn-sm btn-white" data-file-act="delete" style="display: none">\n                    <i class="feather icon-trash red-dark" style="font-size:13px"></i></a>\n                    <a class="btn btn-sm btn-white" data-file-act="preview" ><i class="feather icon-zoom-in"></i></a>\n                    <a class=\'btn btn-sm btn-white\' data-file-act=\'order\' data-order="1" style="display: none"><i class=\'feather icon-arrow-up\'></i></a>\n                    <a class=\'btn btn-sm btn-white\' data-file-act=\'order\' data-order="0" style="display: none"><i class=\'feather icon-arrow-down\'></i></a>\n\n                    </div>').appendTo(i)):(i=a('\n                    <li id="'.concat(y(e.id),'" title="').concat(e.nam,'">\n                    <p class="title" style="display:block">\n                        <i class="feather icon-check green _success icon-success"></i>\n                        ').concat(e.name," (").concat(s,")\n                    </p>\n                    </li>\n                ")),n=a('\n<span style="right: 45px;" class="file-action d-none" data-file-act=\'order\' data-order="1"><i class=\'feather icon-arrow-up\'></i></span>\n<span style="right: 25px;" class="file-action d-none" data-file-act=\'order\' data-order="0"><i class=\'feather icon-arrow-down\'></i></span>\n<span data-file-act="cancel" class="file-action" style="font-size:13px">\n    <i class="feather icon-x red-dark"></i>\n</span>\n<span data-file-act="delete" class="file-action" style="display:none">\n    <i class="feather icon-trash red-dark"></i>\n</span>\n').appendTo(i));var d=i.find("p.imgWrap"),c=a('<p class="error"></p>'),u=function(e,a){var t="";switch(e){case"exceed_size":t=L("exceed_size");break;case"interrupt":t=L("interrupt");break;default:t=L("upload_failed")}x[a.id]=a,c.text(t).appendTo(i)};if(i.appendTo(l),setTimeout((function(){i.css({margin:"5px"})}),50),"invalid"===e.getStatus())u(e.statusText,e);else{if(g){var f=p.makeThumb(e,(function(e,t){var r;if(d.empty(),e)return i.find(".title").show(),void i.find(".file-type").show();U?(r=a('<img src="'+t+'">'),d.append(r)):i.find(".file-type").show()}));try{f.once("load",(function(){e._info=e._info||f.info(),e._meta=e._meta||f.meta();var a=e._info.width,i=e._info.height;if(!function(e){if(!g||!S(e)||!b.helpers.len(t.dimensions))return!0;var a=t.dimensions,i=e._info.width,r=e._info.height,n=b.helpers.isset;if(n(a,"width")&&a.width!=i||n(a,"min_width")&&a.min_width>i||n(a,"max_width")&&a.max_width<i||n(a,"height")&&a.height!=r||n(a,"min_height")&&a.min_height>r||n(a,"max_height")&&a.max_height<r||n(a,"ratio")&&a.ratio!=i/r)return!1;return!0}(e))return b.error("The image dimensions is invalid."),p.removeFile(e),!1;f.resize(a,i)}))}catch(a){return setTimeout((function(){p.removeFile(e)}),10)}}D[e.id]=[e.size,0],e.rotation=0}e.on("statuschange",(function(a,t){"progress"===t||"queued"===t&&(n.find('[data-file-act="cancel"]').hide(),n.find('[data-file-act="delete"]').show()),"error"===a||"invalid"===a?(u(e.statusText,e),D[e.id][1]=1):"interrupt"===a?u("interrupt",e):"queued"===a?D[e.id][1]=0:"progress"===a?c.remove():"complete"===a&&(g?i.append('<span class="success"><em></em><i class="feather icon-check"></i></span>'):i.find("._success").show()),i.removeClass("state-"+t).addClass("state-"+a)})),(g?n.find("a"):n).on("click",(function(){switch(a(this).data("file-act")){case"cancel":return void p.removeFile(e);case"deleteurl":case"delete":if(t.disableRemove)return R(e.serverId),p.removeFile(e);b.confirm(L("confirm_delete_file"),e.serverId,(function(){var i=t.deleteData;if(i.key=e.serverId,!i.key)return R(e.serverId),p.removeFile(e);i._column=r,b.loading(),a.post(t.deleteUrl,i,(function(a){if(b.loading(!1),a.status)return R(e.serverId),void p.removeFile(e);b.error(a.message||"Remove file failed.")}))}));break;case"preview":b.helpers.previewImage(d.find("img").attr("src"),null,e.name);break;case"order":a(this).attr("data-id",e.serverId),$.apply(this)}}))}function j(e){var a=I(e.id);delete D[e.id],O(),a.off().find(".file-panel").off().end().remove()}function O(){var e,t=0,i=0,r=f.find(".progress-bar");a.each(D,(function(e,a){i+=a[0],t+=a[0]*a[1]})),e=i?t/i:0,e=Math.round(100*e)+"%",r.text(e),r.css("width",e),P()}function P(){var e,a="";function t(){(e=p.getStats()).successNum&&(a=L("selected_success",{num:F,size:WebUploader.formatSize(C),success:e.successNum})),e.uploadFailNum&&(a+=(a?L("dot"):"")+L("failed_num",{fail:e.uploadFailNum}))}p&&("ready"===N?(e=p.getStats(),F?a=L("selected_files",{num:F,size:WebUploader.formatSize(C)}):t()):"confirm"===N?(e=p.getStats()).uploadFailNum&&(a=L("selected_has_failed",{success:e.successNum,fail:e.uploadFailNum})):t(),d.html(a))}function Q(e,a){var r;if(a=a||{},e!==N){switch(c&&(c.removeClass("state-"+N),c.addClass("state-"+e)),N=e){case"pedding":if(t.disabled)return;u.removeClass("element-invisible"),l.hide(),o.addClass("element-invisible"),g&&(s.removeAttr("style"),s.find(".queueList").removeAttr("style")),H();break;case"ready":u.addClass("element-invisible"),i.find(k).removeClass("element-invisible"),l.show(),t.disabled||o.removeClass("element-invisible"),H(),g&&s.find(".queueList").css({border:"1px solid #d3dde5",padding:"5px"});break;case"uploading":i.find(k).addClass("element-invisible"),f.show(),c.text(L("pause_upload"));break;case"paused":f.show(),c.text(L("go_on_upload"));break;case"confirm":if(p&&(f.hide(),i.find(k).removeClass("element-invisible"),c.text(L("start_upload")),(r=p.getStats()).successNum&&!r.uploadFailNum))return void Q("finish");break;case"finish":p&&((r=p.getStats()).successNum?(b.success(L("upload_success_message",{success:r.successNum})),setTimeout((function(){1==t.upload.fileNumLimit&&(p.request("get-stats").numOfSuccess=0)}),10)):(N="done",location.reload()));break;case"decrOriginalFileNum":w>0&&w--;break;case"incrOriginalFileNum":w++;break;case"decrFileNumLimit":if(!p)return;"-1"==(n=p.option("fileNumLimit"))&&(n=0),0==(d=n>=(d=a.num||1)?n-d:0)&&(d="-1"),p.option("fileNumLimit",d);break;case"incrFileNumLimit":if(!p)return;var n,d;"-1"==(n=p.option("fileNumLimit"))&&(n=0),d=n+(d=a.num||1),p.option("fileNumLimit",d);break;case"init":c.addClass("state-"+N),O(),w||t.disabled?(u.addClass("element-invisible"),t.disabled?s.addClass("disabled"):o.show(),Q("ready")):g&&(s.removeAttr("style"),s.find(".queueList").css("margin","0")),H()}P()}}function W(e){if(e){var a=E[e];R(e),delete E[e],p&&!a.fake&&p.removeFile(a),Q("decrOriginalFileNum"),Q("incrFileNumLimit"),b.helpers.len(E)||b.helpers.len(D)||Q("pedding")}}function X(){var e=_.val();return e?e.split(","):[]}function q(e){var a=X();a.push(e),B(a)}function B(e){e=e.filter((function(e,a,t){return t.indexOf(e)===a})).filter((function(e){return!!e})),_.val(e.join(","))}function R(e){var a;if(a=e,z=z.filter((function(e){return e.serverId!=a})),!e)return _.val("");B(X().filter((function(a){return a!=e})))}function Z(e){e.serverId&&-1===V(e.serverId)&&z.push(e)}function V(e){for(var a in z)if(z[a].serverId===e)return a;return-1}function G(e,a){var t=parseInt(V(e)),i=z[t],r=z[t-1],n=z[t+1];if(a){if(0===t)return;z[t-1]=i,z[t]=r}else{if(!n)return;z[t+1]=i,z[t]=n}!function(){var e=[];for(var a in z)z[a]&&e.push(z[a].serverId);B(e)}()}function Y(){for(var e in l.html(""),z)z[e]&&J(z[e])}function H(){p.refresh()}function $(){var e=a(this),t=e.parents("li").first(),i=e.data("id"),r=e.data("order"),n=t.prev(),s=t.next();if(r){if(!n.length)return;return G(i,r),void Y()}s.length&&(G(i,r),Y())}function J(e){var i="";i+="<li title='"+e.serverPath+"'>",!g&&t.sortable&&(i+='\n<p style="right: 45px" class="file-action" data-file-act=\'order\' data-order="1" data-id=\''.concat(e.serverId,"'><i class='feather icon-arrow-up'></i></p>\n<p style=\"right: 25px\" class=\"file-action\" data-file-act='order' data-order=\"0\" data-id='").concat(e.serverId,"'><i class='feather icon-arrow-down'></i></p>\n")),g?i+="<p class='imgWrap'><img src='".concat(e.serverUrl,"'></p>"):t.disabled||(i+='<p class="file-action" data-file-act="delete" data-id="'.concat(e.serverId,'"><i class="feather icon-trash red-dark"></i></p>')),i+="<p class='title' style=''><i class='feather icon-check text-white icon-success text-white'></i>",i+=e.serverPath,i+="</p>",g&&(i+="<p class='title' style='margin-bottom:20px;'>&nbsp;</p>",i+="<div class='file-panel' >",t.disabled||(i+="<a class='btn btn-sm btn-white' data-file-act='deleteurl' data-id='".concat(e.serverId,"'><i class='feather icon-trash red-dark' style='font-size:13px'></i></a>")),i+="<a class='btn btn-sm btn-white' data-file-act='preview' data-url='".concat(e.serverUrl,"' ><i class='feather icon-zoom-in'></i></a>"),t.sortable&&(i+="\n<a class='btn btn-sm btn-white' data-file-act='order' data-order=\"1\" data-id='".concat(e.serverId,"'><i class='feather icon-arrow-up'></i></a>\n<a class='btn btn-sm btn-white' data-file-act='order' data-order=\"0\" data-id='").concat(e.serverId,"'><i class='feather icon-arrow-down'></i></a>\n")),i+="</div>"),i=a(i+="</li>"),g||(i.find(".file-type").show(),i.find(".title").show(),s.css("background","transparent"));var n=function(){var n=a(this).data("id"),s=t.deleteData;if(t.disableRemove)return i.remove(),W(n);b.confirm(L("confirm_delete_file"),e.serverId,(function(){s.key=n,s._column=r,b.loading(),a.post(t.deleteUrl,s,(function(e){if(b.loading(!1),e.status)return i.remove(),void W(n);b.error(e.message||"Remove file failed.")}))}))};i.find('[data-file-act="deleteurl"]').click(n),i.find('[data-file-act="delete"]').click(n),t.sortable&&i.find('[data-file-act="order"').click($),i.find('[data-file-act="preview"]').click((function(){var e=a(this).data("url");b.helpers.previewImage(e)})),E[e.serverId]=e,q(e.serverId),l.append(i),g&&(setTimeout((function(){i.css("margin","5px")}),m?0:400),m=1)}return this.uploader=p,this.options=t,this.build=function(){s=i.find(t.wrapper),l=a('<ul class="filelist"></ul>').appendTo(s.find(".queueList")),o=s.find(".statusBar"),d=o.find(".info"),c=s.find(".upload-btn"),u=s.find(".placeholder"),f=o.find(".upload-progress").hide(),function(){if(!WebUploader.Uploader.support("flash")&&WebUploader.browser.ie)return void(A?function(e){window.expressinstallcallback=function(e){switch(e){case"Download.Cancelled":break;case"Download.Failed":b.error("Install failed!");break;default:b.success("Install Success！")}delete window.expressinstallcallback};var a="./expressInstall.swf",t='<object type="application/x-shockwave-flash" data="'.concat(a,'" ');WebUploader.browser.ie&&(t+='classid="clsid:d27cdb6e-ae6d-11cf-96b8-444553540000" '),t+='width="100%" height="100%" style="outline:0">\n                            <param name="movie" value="'.concat(a,'" />\n                            <param name="wmode" value="transparent" />\n                            <param name="allowscriptaccess" value="always" />\n                            </object>'),e.html(t)}(s):s.html('<a href="http://www.adobe.com/go/getflashplayer" target="_blank" border="0"><img alt="get flash player" src="http://www.adobe.com/macromedia/style_guide/images/160x41_Get_Flash_Player.jpg" /></a>'));if(!WebUploader.Uploader.support())b.error("您的浏览器不支持Web Uploader！")}(),this.uploader=p=WebUploader.create(t.upload),p.on("dndAccept",(function(e){for(var a=!1,t=e.length,i=0;i<t;i++)if(~"text/plain;application/javascript ".indexOf(e[i].type)){a=!0;break}return!a})),t.upload.fileNumLimit>1&&!t.disabled&&p.addButton({id:k,label:'<i class="feather icon-folder"></i> &nbsp;'+L("go_on_add")}),p.onUploadProgress=function(e,a){D[e.id][1]=a,O()},p.onBeforeFileQueued=function(e){},p.onFileQueued=function(e){F++,C+=e.size,1===F&&(u.addClass("element-invisible"),o.show()),M(e),Q("ready"),O()},p.onFileDequeued=function(e){F--,C-=e.size,F||b.helpers.len(E)||Q("pedding"),j(e)},p.on("all",(function(e,i,n){switch(e){case"uploadFinished":Q("confirm"),l=X(),o=p.getStats().successNum,d=a.extend({},t.formData),o&&l&&t.autoUpdateColumn&&(d[r]=l.join(","),delete d.upload_column,a.post(t.updateServer,d));break;case"startUpload":Q("uploading");break;case"stopUpload":Q("paused");break;case"uploadAccept":if(n&&n.error)return b.error(n.error.message),x[i.file.id]=i.file,!1;if(n.merge)return;i.file.serverId=n.id,i.file.serverName=n.name,i.file.serverPath=n.path,i.file.serverUrl=n.url||null,Z(i.file),q(n.id);var s=I(i.file.id);g||(s.find(".file-action").hide(),s.find('[data-file-act="delete"]').show()),t.sortable&&s.find('[data-file-act="order"]').removeClass("d-none").show()}var l,o,d})),p.onError=function(e){switch(e){case"Q_TYPE_DENIED":b.error(L("Q_TYPE_DENIED"));break;case"Q_EXCEED_NUM_LIMIT":b.error(L("Q_EXCEED_NUM_LIMIT",{num:t.upload.fileNumLimit}));break;case"F_EXCEED_SIZE":b.error(L("F_EXCEED_SIZE"));break;case"Q_EXCEED_SIZE_LIMIT":b.error(L("Q_EXCEED_SIZE_LIMIT"));break;case"F_DUPLICATE":b.warning(L("F_DUPLICATE"));break;default:b.error("Error: "+e)}},c.on("click",(function(){if(a(this).hasClass("disabled"))return!1;"ready"===N||"paused"===N?p.upload():"uploading"===N&&p.stop()})),d.on("click",".retry",(function(){p.retry()})),d.on("click",".ignore",(function(){for(var e in x)p.removeFile(e,!0),delete x[e]})),Q("init")},this.preview=function(){for(var e in t.preview){var a,i=t.preview[e].path;i.indexOf(".")&&(a=i.split(".").pop());var r={serverId:t.preview[e].id,serverUrl:t.preview[e].url,serverPath:i,ext:a,fake:1};Q("incrOriginalFileNum"),Q("decrFileNumLimit"),J(r),Z(r)}},this.setState=Q,this.refreshButton=H,this.getFileView=I,this.getFileViewSelector=y,this.addFileView=M,this.removeUploadFileView=j,this.isImage=S,this.getColumn=function(){return r},this}Dcat.Uploader=function(e){return new t(e)}}(window,jQuery)}});
//# sourceMappingURL=upload.js.map